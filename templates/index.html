{% extends "base.html" %}

{% block title %}Роза Ветров{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4 custom-font text-5xl">
            Рейтинг волонтеров 2025
        </h1>


        <!-- Таблица данных -->
        <div class="table-container">
            {% if data.status == 'success' and data.data.records %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                {% if data.data.metadata.columns is iterable %}
                                    {% for column in data.data.metadata.columns %}
                                        {% if column is string %}
                                            <th>{{ column }}</th>
                                        {% elif column.name is defined %}
                                            <th>{{ column.name }}</th>
                                        {% else %}
                                            <th>Column {{ loop.index }}</th>
                                        {% endif %}
                                    {% endfor %}
                                {% elif data.data.headers is defined %}
                                    {% for header in data.data.headers %}
                                        <th>{{ header }}</th>
                                    {% endfor %}
                                {% else %}
                                    <!-- Если структура данных другая, создаем заголовки на основе первого элемента -->
                                    {% if data.data.records[0] %}
                                        {% for key in data.data.records[0].keys() %}
                                            <th>{{ key }}</th>
                                        {% endfor %}
                                    {% endif %}
                                {% endif %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for record in data.data.records %}
                            <tr>
                                {% if data.data.metadata.columns is iterable %}
                                    {% for column in data.data.metadata.columns %}
                                        {% if column is string %}
                                            {% set column_name = column %}
                                        {% elif column.name is defined %}
                                            {% set column_name = column.name %}
                                        {% else %}
                                            {% set column_name = "column_" ~ loop.index %}
                                        {% endif %}
                                        <td>
                                            {% if record[column_name] is none or record[column_name] == '' %}
                                                <span class="text-muted">-</span>
                                            {% else %}
                                                {{ record[column_name] }}
                                            {% endif %}
                                        </td>
                                    {% endfor %}
                                {% else %}
                                    <!-- Альтернативный способ отображения если columns не определен -->
                                    {% for value in record.values() %}
                                        <td>
                                            {% if value is none or value == '' %}
                                                <span class="text-muted">-</span>
                                            {% else %}
                                                {{ value }}
                                            {% endif %}
                                        </td>
                                    {% endfor %}
                                {% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
